{% liquid
  assign logo_position = section.settings.logo_position
  assign menu_type_desktop = section.settings.menu_type_desktop
  assign enable_sticky_header = section.settings.enable_sticky_header
  assign show_search = section.settings.show_search
  assign menu = section.settings.menu
%}

<header
  class="site-header color-{{ section.settings.color_scheme }} header-layout-{{ logo_position }} {% if enable_sticky_header %}header-sticky{% endif %}"
  style="
    margin-top: {{ section.settings.margin_top }}px;
    margin-bottom: {{ section.settings.margin_bottom }}px;
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  "
  data-section-id="{{ section.id }}"
  data-menu-type="{{ menu_type_desktop }}"
>
  <div class="header-wrapper">
    <!-- Mobile Menu Button (Left) -->
    <button class="header__mobile-menu-btn mobile-only" aria-label="Open menu">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M3 12h18M3 6h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>

    <!-- Logo Section (Desktop only) -->
    <div class="header__logo desktop-only">
      <a href="{{ routes.root_url }}" class="header__logo-link">
        {% if settings.logo != blank %}
          <img
            src="{{ settings.logo | image_url: width: section.settings.logo_width }}"
            alt="{{ shop.name }}"
            width="{{ section.settings.logo_width }}"
            height="auto"
            loading="eager"
            class="header__logo-image"
          />
        {% else %}
          <h1 class="header__title">{{ shop.name }}</h1>
        {% endif %}
      </a>
    </div>

    <!-- Mobile Search Bar (replaces logo on mobile) -->
    <div class="header__mobile-search mobile-only">
      <form action="{{ routes.search_url }}" method="get" role="search" class="mobile-header-search-form">
        <svg width="18" height="18" viewBox="0 0 20 20" fill="none" class="mobile-header-search-icon">
          <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="2"/>
          <path d="M12.5 12.5L17 17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input type="hidden" name="type" value="product">
        <input
          type="search"
          id="MobileHeaderSearchInput"
          name="q"
          placeholder="Search products..."
          autocomplete="off"
          class="mobile-header-search-input"
        />
      </form>
      <div id="MobileHeaderPredictiveResults" class="mobile-header-predictive-search"></div>
    </div>

    <!-- Desktop Menu -->
    <nav class="header__menu desktop-only" aria-label="Main navigation">
      {% if menu_type_desktop == 'standard' %}
        <ul class="header__menu-list">
          {% for link in linklists[menu].links %}
            <li class="header__menu-item {% if link.links != blank %}has-dropdown{% endif %}">
              <a href="{{ link.url }}" class="header__menu-link">
                {{ link.title }}
                {% if link.links != blank %}
                  <svg width="12" height="12" viewBox="0 0 12 12" class="dropdown-icon">
                    <path d="M6 8L2 4h8z" fill="currentColor"/>
                  </svg>
                {% endif %}
              </a>

              {% if link.links != blank %}
                <ul class="header__submenu">
                  {% for child_link in link.links %}
                    <li class="header__submenu-item">
                      <a href="{{ child_link.url }}" class="header__submenu-link">
                        {{ child_link.title }}
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% elsif menu_type_desktop == 'mega' %}
        <ul class="header__menu-list header__menu-mega">
          {% for link in linklists[menu].links %}
            {% assign mega_index = forloop.index0 %}
            <li class="header__menu-item {% if link.links != blank %}has-mega-menu{% endif %}" data-mega-index="{{ mega_index }}">
              <a href="{{ link.url }}" class="header__menu-link">
                {{ link.title }}
                {% if link.links != blank %}
                  <svg width="12" height="12" viewBox="0 0 12 12" class="dropdown-icon">
                    <path d="M6 8L2 4h8z" fill="currentColor"/>
                  </svg>
                {% endif %}
              </a>

              {% if link.links != blank %}
                <div class="header__mega-menu">
                  <div class="mega-menu-inner">
                    <div class="mega-menu-links">
                      {% for child_link in link.links %}
                        <div class="mega-menu-column">
                          <a href="{{ child_link.url }}" class="mega-menu-title">
                            {{ child_link.title }}
                          </a>
                          {% if child_link.links != blank %}
                            <ul class="mega-menu-list">
                              {% for grandchild_link in child_link.links %}
                                <li>
                                  <a href="{{ grandchild_link.url }}">{{ grandchild_link.title }}</a>
                                </li>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        </div>
                      {% endfor %}
                    </div>

                    {%- comment -%} Promo images from blocks matching this menu index {%- endcomment -%}
                    {% assign promo_blocks_exist = false %}
                    {% for block in section.blocks %}
                      {% if block.type == 'mega_menu_promo' and block.settings.menu_index == mega_index %}
                        {% assign promo_blocks_exist = true %}
                        {% break %}
                      {% endif %}
                    {% endfor %}

                    {% if promo_blocks_exist %}
                      <div class="mega-menu-promos">
                        {% for block in section.blocks %}
                          {% if block.type == 'mega_menu_promo' and block.settings.menu_index == mega_index %}
                            <a
                              href="{{ block.settings.promo_url | default: '#' }}"
                              class="mega-promo-card"
                              {{ block.shopify_attributes }}
                            >
                              <div class="mega-promo-card__image">
                                {% if block.settings.promo_image %}
                                  <img
                                    src="{{ block.settings.promo_image | image_url: width: 480, height: 600, crop: 'center' }}"
                                    alt="{{ block.settings.promo_heading | escape }}"
                                    width="480"
                                    height="600"
                                    loading="lazy"
                                  >
                                {% else %}
                                  <div class="mega-promo-card__placeholder">
                                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                                  </div>
                                {% endif %}
                              </div>
                              <div class="mega-promo-card__content">
                                {% if block.settings.promo_label != blank %}
                                  <span class="mega-promo-card__label">{{ block.settings.promo_label }}</span>
                                {% endif %}
                                {% if block.settings.promo_heading != blank %}
                                  <span class="mega-promo-card__heading">{{ block.settings.promo_heading }}</span>
                                {% endif %}
                                {% if block.settings.promo_cta != blank %}
                                  <span class="mega-promo-card__cta">
                                    {{ block.settings.promo_cta }}
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
                                  </span>
                                {% endif %}
                              </div>
                            </a>
                          {% endif %}
                        {% endfor %}
                      </div>
                    {% endif %}
                  </div>
                </div>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </nav>

    <!-- Right Section -->
    <div class="header__right">
      <!-- Search -->
      {% if show_search %}
        <div class="header__search desktop-only">
          <form action="{{ routes.search_url }}" method="get" role="search" class="header__search-form">
            <input type="hidden" name="type" value="product">
            <input
              type="search"
              id="HeaderSearchInput"
              name="q"
              placeholder="Search..."
              autocomplete="off"
              class="search-input"
            />
            <button type="submit" class="search-btn" aria-label="Search">
              <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="2"/>
                <path d="M12.5 12.5L17 17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </form>
          <div id="PredictiveResults" class="predictive-search"></div>
          <div id="RecentSearches" class="recent-searches"></div>
        </div>
      {% endif %}

      <!-- Icons -->
      <div class="header__icons">
        {% if shop.customer_accounts_enabled %}
          <a href="{{ routes.account_url }}" class="header__icon" aria-label="Account">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <circle cx="10" cy="7" r="3" stroke="currentColor" stroke-width="2"/>
              <path d="M4 18c0-3.5 2.5-6 6-6s6 2.5 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </a>
        {% endif %}

        <a href="{{ routes.cart_url }}" class="header__icon header__cart-icon" aria-label="Cart" data-cart-type="{{ settings.cart_type }}">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M2 2h2l1.5 10h11l2-8H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="7" cy="17" r="1" fill="currentColor"/>
            <circle cx="15" cy="17" r="1" fill="currentColor"/>
          </svg>
          {% if cart.item_count > 0 %}
            <span class="cart-count">{{ cart.item_count }}</span>
          {% endif %}
        </a>
      </div>
    </div>
  </div>
</header>

<!-- Mobile Menu Drawer - Outside header for proper z-index stacking -->
{% assign mobile_logo_pos = section.settings.mobile_menu_logo_position | default: 'top-left' %}
<div class="mobile-menu-drawer mobile-only mobile-logo-{{ mobile_logo_pos }}">
  <div class="mobile-menu-header">
    {% if mobile_logo_pos == 'top-left' or mobile_logo_pos == 'top-center' or mobile_logo_pos == 'top-right' %}
      <div class="mobile-menu-logo">
        <a href="{{ routes.root_url }}">
          {% if settings.logo != blank %}
            <img src="{{ settings.logo | image_url: width: section.settings.mobile_menu_logo_width }}" alt="{{ shop.name }}" class="mobile-menu-logo-img" width="{{ section.settings.mobile_menu_logo_width }}" height="auto" loading="lazy">
          {% else %}
            <span class="mobile-menu-logo-text">{{ shop.name }}</span>
          {% endif %}
        </a>
      </div>
    {% endif %}
    <button class="mobile-menu-close" aria-label="Close menu">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
  </div>

  <nav class="mobile-menu-nav" aria-label="Mobile navigation">
    <ul class="mobile-menu-list">
      {% for link in linklists[section.settings.mobile_menu].links %}
        <li class="mobile-menu-item">
          <a href="{{ link.url }}" class="mobile-menu-link">
            {{ link.title }}
          </a>
          {% if link.links != blank %}
            <button class="mobile-submenu-toggle" aria-label="Toggle submenu">
              <svg width="12" height="12" viewBox="0 0 12 12">
                <path d="M6 8L2 4h8z" fill="currentColor"/>
              </svg>
            </button>
            <ul class="mobile-submenu">
              {% for child_link in link.links %}
                <li>
                  <a href="{{ child_link.url }}">{{ child_link.title }}</a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </nav>


  {% if mobile_logo_pos == 'bottom-left' or mobile_logo_pos == 'bottom-center' or mobile_logo_pos == 'bottom-right' %}
    <div class="mobile-menu-logo mobile-menu-logo--bottom">
      <a href="{{ routes.root_url }}">
        {% if settings.logo != blank %}
          <img src="{{ settings.logo | image_url: width: section.settings.mobile_menu_logo_width }}" alt="{{ shop.name }}" class="mobile-menu-logo-img" width="{{ section.settings.mobile_menu_logo_width }}" height="auto" loading="lazy">
        {% else %}
          <span class="mobile-menu-logo-text">{{ shop.name }}</span>
        {% endif %}
      </a>
    </div>
  {% endif %}
</div>

<div class="mobile-menu-overlay mobile-only"></div>

{% stylesheet %}
/* Header Base Styles */
.site-header {
  width: 100%;
  position: relative;
  z-index: 100;
  background: var(--color-background);
  color: var(--color-foreground);
  transition: background 0.4s ease, color 0.4s ease, box-shadow 0.4s ease;
}

.header-sticky {
  position: fixed;
  top: var(--announcement-bar-height, 0px);
  left: 0;
  right: 0;
  z-index: 1000;
  will-change: transform;
  transform: translateY(0);
  transition: transform 0.3s ease, top 0.3s ease, background 0.4s ease, color 0.4s ease, box-shadow 0.4s ease;
}

.header-sticky.announcement-hidden {
  top: 0;
}

/* Scrolled: always white background with dark text */
.header-sticky.scrolled {
  background: #fff !important;
  color: #222 !important;
  box-shadow: 0 1px 12px rgba(0, 0, 0, 0.08);
}

.header-sticky.scrolled .header__menu-link,
.header-sticky.scrolled .header__icon,
.header-sticky.scrolled .header__title,
.header-sticky.scrolled .header__logo-link,
.header-sticky.scrolled .header__mobile-menu-btn,
.header-sticky.scrolled .search-btn,
.header-sticky.scrolled .search-input,
.header-sticky.scrolled .dropdown-icon {
  color: #222;
}

.header-sticky.scrolled .header__search-form {
  background: rgba(0, 0, 0, 0.04);
  border-color: rgba(0, 0, 0, 0.1);
}

.header-sticky.scrolled .search-input::placeholder {
  color: #222;
  opacity: 0.5;
}

/* Remove logo invert on scrolled */
.header-sticky.scrolled .header__logo-image {
  filter: none;
}

.header-sticky.hidden {
  transform: translateY(-100%);
}

.header-wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
  max-width: 1400px;
  margin: 0 auto;
  padding: 10px 20px;
}
.highlight{
  padding: 6px 10px !important;
}

/* Logo Positioning Layouts */
.header-layout-top-left .header-wrapper {
  justify-content: flex-start;
}

.header-layout-top-left .header__logo {
  order: 1;
}

.header-layout-top-left .header__menu {
  order: 2;
  margin-left: 40px;
}

.header-layout-top-left .header__right {
  order: 3;
  margin-left: auto;
}

.header-layout-top-center .header-wrapper {
  flex-direction: column;
  min-height: auto;
  padding: 15px 20px;
}

.header-layout-top-center .header__logo {
  order: 1;
  margin-bottom: 15px;
}

.header-layout-top-center .header__menu {
  order: 2;
}

.header-layout-top-center .header__right {
  order: 3;
  position: absolute;
  right: 20px;
  top: 20px;
}

.header-layout-top-right .header-wrapper {
  justify-content: flex-end;
}

.header-layout-top-right .header__logo {
  order: 3;
}

.header-layout-top-right .header__menu {
  order: 2;
  margin-right: 40px;
}

.header-layout-top-right .header__right {
  order: 1;
  margin-right: auto;
}

.header-layout-middle-left .header-wrapper,
.header-layout-middle-center .header-wrapper,
.header-layout-middle-right .header-wrapper {
  align-items: center;
}

.header-layout-middle-center .header__logo {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
}

.header-layout-middle-center .header__menu {
  margin-right: auto;
}

.header-layout-middle-right .header__logo {
  order: 3;
  margin-left: auto;
}

/* Logo Styles */
.header__logo-link {
  display: block;
  text-decoration: none;
  color: inherit;
  transition: color 0.4s ease;
}

.header__logo-image {
  display: block;
  max-width: 100%;
  height: auto;
  transition: filter 0.4s ease;
}


.header__title {
  font-size: 24px;
  font-weight: 700;
  margin: 0;
  color: inherit;
  transition: color 0.4s ease;
}

/* Desktop Menu Styles */
.header__menu {
  flex: 1;
}

.header__menu-list {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 30px;
  align-items: center;
}

.header__menu-link {
  display: flex;
  align-items: center;
  gap: 5px;
  text-decoration: none;
  color: inherit;
  font-size: 15px;
  font-weight: 500;
  padding: 10px 0;
  transition: color 0.4s ease;
}

.header__menu-link:hover {
  opacity: 0.7;
}

.dropdown-icon {
  transition: transform 0.2s;
}

.header__menu-item:hover .dropdown-icon {
  transform: rotate(180deg);
}

/* Standard Dropdown */
.header__submenu {
  position: absolute;
  top: 100%;
  left: 0;
  background: var(--color-background);
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  border-radius: 8px;
  padding: 10px 0;
  list-style: none;
  margin: 0;
  min-width: 200px;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: all 0.3s ease;
  z-index: 1000;
}

.header__menu-item {
  position: relative;
}

.header__menu-item:hover .header__submenu {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.header__submenu-link {
  display: block;
  padding: 10px 20px;
  color: var(--color-foreground);
  text-decoration: none;
  font-size: 14px;
  transition: background 0.2s;
}

.header__submenu-link:hover {
  background: var(--color-secondary);
}

/* Mega Menu */
.has-mega-menu {
  position: static;
}

.header__mega-menu {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: var(--color-background);
  box-shadow: 0 8px 40px rgba(0, 0, 0, 0.08);
  border-top: 1px solid rgba(0, 0, 0, 0.06);
  padding: 0;
  opacity: 0;
  visibility: hidden;
  transform: translateY(4px);
  transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
  z-index: 1000;
}

.header__mega-menu::before {
  content: '';
  position: absolute;
  top: -16px;
  left: 0;
  right: 0;
  height: 16px;
}

.has-mega-menu:hover .header__mega-menu {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.mega-menu-inner {
  display: flex;
  max-width: 1400px;
  margin: 0 auto;
  padding: 40px 40px;
  gap: 40px;
}

.mega-menu-links {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 32px;
  flex: 1;
  min-width: 0;
}

.mega-menu-column {
  min-width: 0;
}

.mega-menu-title {
  display: inline-block;
  font-weight: 600;
  color: var(--color-foreground);
  margin-bottom: 16px;
  text-decoration: none;
  font-size: 15px;
  letter-spacing: -0.01em;
  position: relative;
  padding-bottom: 8px;
}

.mega-menu-title::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 24px;
  height: 2px;
  background: var(--color-primary, #c28946);
  border-radius: 1px;
  transition: width 0.3s ease;
}

.mega-menu-title:hover::after {
  width: 100%;
}

.mega-menu-list {
  list-style: none;
  margin: 0;
  padding: 0;
}

.mega-menu-list li {
  margin: 0;
}

.mega-menu-list a {
  display: inline-block;
  padding: 6px 0;
  color: var(--color-foreground);
  text-decoration: none;
  font-size: 14px;
  opacity: 0.7;
  transition: opacity 0.2s, color 0.2s, padding-left 0.2s;
}

.mega-menu-list a:hover {
  color: var(--color-primary, #c28946);
  opacity: 1;
  padding-left: 4px;
}

/* Mega Promo Cards */
.mega-menu-promos {
  display: flex;
  gap: 16px;
  flex-shrink: 0;
  max-width: 480px;
}

.mega-promo-card {
  display: flex;
  flex-direction: column;
  width: 220px;
  border-radius: 12px;
  overflow: hidden;
  text-decoration: none;
  color: var(--color-foreground);
  background: var(--color-secondary, #f5f5f5);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.mega-promo-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.1);
}

.mega-promo-card__image {
  position: relative;
  aspect-ratio: 4 / 5;
  overflow: hidden;
  background: var(--color-secondary, #f5f5f5);
}

.mega-promo-card__image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.5s ease;
}

.mega-promo-card:hover .mega-promo-card__image img {
  transform: scale(1.06);
}

.mega-promo-card__placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-foreground);
  opacity: 0.2;
}

.mega-promo-card__content {
  padding: 14px 16px 16px;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.mega-promo-card__label {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--color-primary, #c28946);
}

.mega-promo-card__heading {
  font-size: 15px;
  font-weight: 600;
  line-height: 1.3;
  color: var(--color-foreground);
}

.mega-promo-card__cta {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 13px;
  font-weight: 600;
  color: var(--color-primary, #c28946);
  margin-top: 4px;
  transition: gap 0.2s ease;
}

.mega-promo-card:hover .mega-promo-card__cta {
  gap: 8px;
}

@media (max-width: 1100px) {
  .mega-menu-promos {
    display: none;
  }
}

/* Header Right Section */
.header__right {
  display: flex;
  align-items: center;
  gap: 20px;
}

/* Search - Inline in Header */
.header__search {
  position: relative;
}

.header__search-form {
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(0, 0, 0, 0.04);
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 20px;
  padding: 8px 16px;
  min-width: 200px;
  transition: all 0.4s ease;
}

.header__search-form:focus-within {
  background: var(--color-background);
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(74, 144, 217, 0.1);
  min-width: 250px;
}

.search-input {
  flex: 1;
  border: none;
  background: transparent;
  outline: none;
  color: inherit;
  font-size: 14px;
  width: 100%;
  transition: color 0.4s ease;
}

.search-input::placeholder {
  color: inherit;
  opacity: 0.5;
  transition: color 0.4s ease;
}

.search-btn {
  background: none;
  border: none;
  color: inherit;
  cursor: pointer;
  padding: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: color 0.4s ease;
  flex-shrink: 0;
}

.search-btn:hover {
  opacity: 0.7;
}

/* Predictive Search */
.predictive-search,
.recent-searches {
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  right: 0;
  min-width: 300px;
  background: var(--color-background);
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  border: 1px solid rgba(0, 0, 0, 0.1);
  overflow: hidden;
  display: none;
  z-index: 1001;
  max-height: 400px;
  overflow-y: auto;
}

.predictive-search a,
.recent-searches div {
  display: block;
  padding: 12px 15px;
  border-bottom: 1px solid var(--color-secondary);
  font-size: 14px;
  color: var(--color-foreground);
  text-decoration: none;
}

.predictive-search a:hover,
.recent-searches div:hover {
  background: var(--color-secondary);
}

.search-item {
  display: flex !important;
  align-items: center;
  gap: 12px;
}

.search-item img {
  width: 50px;
  height: 50px;
  object-fit: cover;
  border-radius: 6px;
}

.search-title {
  font-weight: 500;
}

.search-price {
  font-size: 13px;
  opacity: 0.7;
}

.no-results {
  padding: 20px;
  text-align: center;
  color: var(--color-foreground);
  opacity: 0.7;
}

.view-all {
  font-weight: 600;
  text-align: center;
  background: var(--color-secondary);
}

/* Header Icons */
.header__icons {
  display: flex;
  align-items: center;
  gap: 15px;
}

.header__icon {
  color: inherit;
  text-decoration: none;
  position: relative;
  display: flex;
  align-items: center;
  padding: 8px;
  transition: color 0.4s ease;
}

.header__icon:hover {
  opacity: 0.7;
}

.cart-count {
  position: absolute;
  top: 0;
  right: 0;
  background: var(--color-button);
  color: var(--color-button-label);
  font-size: 10px;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 10px;
  min-width: 18px;
  text-align: center;
}

/* Mobile Styles */
.mobile-only {
  display: none;
}

.desktop-only {
  display: flex;
}

/* Mobile Header Search Bar */
.header__mobile-search {
  flex: 1;
  margin: 0 12px;
  position: relative;
  display: none;
}

.mobile-header-search-form {
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(0, 0, 0, 0.05);
  border: 1px solid rgba(0, 0, 0, 0.08);
  border-radius: 24px;
  padding: 8px 14px;
  transition: border-color 0.2s ease, background 0.2s ease;
}

.mobile-header-search-form:focus-within {
  background: #fff;
  border-color: rgba(0, 0, 0, 0.2);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.mobile-header-search-icon {
  flex-shrink: 0;
  opacity: 0.4;
}

.mobile-header-search-input {
  flex: 1;
  border: none;
  background: transparent;
  outline: none;
  color: inherit;
  font-size: 14px;
  width: 100%;
  min-width: 0;
}

.mobile-header-search-input::placeholder {
  color: inherit;
  opacity: 0.45;
}

.mobile-header-predictive-search {
  position: absolute;
  top: calc(100% + 6px);
  left: 0;
  right: 0;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  border: 1px solid rgba(0, 0, 0, 0.08);
  overflow: hidden;
  display: none;
  z-index: 1001;
  max-height: 350px;
  overflow-y: auto;
}

.mobile-header-predictive-search a {
  display: block;
  padding: 10px 14px;
  border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  font-size: 14px;
  color: #222;
  text-decoration: none;
}

.mobile-header-predictive-search a:last-child {
  border-bottom: none;
}

.mobile-header-predictive-search a:hover {
  background: rgba(0, 0, 0, 0.03);
}

.mobile-header-predictive-search .search-item {
  display: flex !important;
  align-items: center;
  gap: 10px;
}

.mobile-header-predictive-search .search-item img {
  width: 40px;
  height: 40px;
  object-fit: cover;
  border-radius: 6px;
}

.mobile-header-predictive-search .search-title {
  font-weight: 500;
  font-size: 13px;
}

.mobile-header-predictive-search .search-price {
  font-size: 12px;
  opacity: 0.6;
}

.mobile-header-predictive-search .no-results {
  padding: 16px;
  text-align: center;
  color: #222;
  opacity: 0.6;
  font-size: 13px;
}

.mobile-header-predictive-search .view-all {
  font-weight: 600;
  text-align: center;
  background: rgba(0, 0, 0, 0.03);
  font-size: 13px;
}

/* Mobile Menu Button */
.header__mobile-menu-btn {
  background: none;
  border: none;
  color: inherit;
  cursor: pointer;
  padding: 8px;
  align-items: center;
  transition: color 0.4s ease, transform 0.2s ease;
  -webkit-tap-highlight-color: transparent;
}

.header__mobile-menu-btn:active {
  transform: scale(0.9);
}

/* Mobile Menu Drawer */
.mobile-menu-drawer {
  position: fixed;
  top: 0;
  left: -100%;
  width: 100%;
  max-width: 100%;
  height: 100vh;
  height: 100dvh;
  background: #fff;
  box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
  transition: left 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 10000 !important;
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  will-change: left;
  color: #222;
  display: flex;
  flex-direction: column;
}

.mobile-menu-drawer.active {
  left: 0 !important;
  visibility: visible !important;
  display: block !important;
}

.mobile-menu-header {
  display: flex;
  align-items: center;
  padding: 20px;
  border-bottom: 1px solid rgba(0, 0, 0, 0.06);
  background: #fff;
  position: sticky;
  top: 0;
  z-index: 10;
}

.mobile-menu-header::before {
  display: none;
}

/* Mobile Menu Logo */
.mobile-menu-logo {
  flex: 1;
}

.mobile-menu-logo a {
  display: inline-block;
  text-decoration: none;
}

.mobile-menu-logo-img {
  max-width: 100%;
  height: auto;
  display: block;
}

.mobile-menu-logo-text {
  font-size: 20px;
  font-weight: 700;
  color: #222;
}

.mobile-menu-logo--bottom {
  padding: 20px 24px;
  border-top: 1px solid rgba(0, 0, 0, 0.06);
  margin-top: auto;
}

/* Logo positions - Top */
.mobile-logo-top-left .mobile-menu-header {
  justify-content: space-between;
}
.mobile-logo-top-left .mobile-menu-logo {
  text-align: left;
}

.mobile-logo-top-center .mobile-menu-header {
  justify-content: space-between;
}
.mobile-logo-top-center .mobile-menu-logo {
  text-align: center;
}

.mobile-logo-top-right .mobile-menu-header {
  flex-direction: row-reverse;
  justify-content: space-between;
}
.mobile-logo-top-right .mobile-menu-logo {
  text-align: right;
}

/* Logo positions - Bottom */
.mobile-logo-bottom-left .mobile-menu-header {
  justify-content: flex-end;
}
.mobile-logo-bottom-left .mobile-menu-logo--bottom {
  text-align: left;
}

.mobile-logo-bottom-center .mobile-menu-header {
  justify-content: flex-end;
}
.mobile-logo-bottom-center .mobile-menu-logo--bottom {
  text-align: center;
}

.mobile-logo-bottom-right .mobile-menu-header {
  justify-content: flex-end;
}
.mobile-logo-bottom-right .mobile-menu-logo--bottom {
  text-align: right;
}

.mobile-menu-close {
  background: rgba(0, 0, 0, 0.06);
  border: none;
  color: #222;
  cursor: pointer;
  padding: 8px;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s ease;
}

.mobile-menu-close:hover {
  background: rgba(0, 0, 0, 0.12);
  color: #222;
}

.mobile-menu-list {
  list-style: none;
  margin: 0;
  padding: 10px 0;
}

.mobile-menu-item {
  border-bottom: 1px solid rgba(0, 0, 0, 0.06);
  position: relative;
}

.mobile-menu-item:last-child {
  border-bottom: none;
}

.mobile-menu-link {
  display: block;
  padding: 18px 24px;
  color: #222;
  text-decoration: none;
  font-size: 18px;
  font-weight: 500;
  transition: background 0.2s ease, padding-left 0.2s ease;
}

.mobile-menu-link:hover,
.mobile-menu-link:active {
  background: rgba(0, 0, 0, 0.04);
  padding-left: 32px;
}

.mobile-submenu {
  list-style: none;
  padding: 0;
  margin: 0;
  display: none;
  background: rgba(0, 0, 0, 0.02);
}

.mobile-submenu.active {
  display: block;
}

.mobile-submenu a {
  display: block;
  padding: 14px 24px 14px 44px;
  color: #555;
  text-decoration: none;
  font-size: 15px;
  transition: background 0.2s ease, padding-left 0.2s ease, color 0.2s ease;
}

.mobile-submenu a:hover,
.mobile-submenu a:active {
  background: rgba(0, 0, 0, 0.04);
  padding-left: 52px;
  color: #222;
}

.mobile-submenu-toggle {
  background: none;
  border: none;
  color: rgba(0, 0, 0, 0.4);
  cursor: pointer;
  position: absolute;
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
  padding: 8px;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.3s ease;
}

.mobile-submenu-toggle.active {
  transform: translateY(-50%) rotate(180deg);
}


.mobile-menu-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;
  height: 100dvh; /* Dynamic viewport height */
  background: rgba(0,0,0,0.6);
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  z-index: 9999 !important;
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
  pointer-events: none;
}

.mobile-menu-overlay.active {
  opacity: 1 !important;
  visibility: visible !important;
  pointer-events: auto !important;
  display: block !important;
}

/* Responsive */
@media screen and (max-width: 1024px) {
  .header__search {
    display: none !important;
  }

  .header__menu {
    display: none !important;
  }
}

@media screen and (max-width: 768px) {
  .desktop-only {
    display: none !important;
  }

  .mobile-only {
    display: block;
  }

  .header__mobile-menu-btn {
    display: flex;
  }

  /* Mobile header inherits color scheme, scrolled always white */

  .header-wrapper {
    padding: 8px 15px;
  }

  .header__mobile-search {
    display: block;
  }

  .header__title {
    font-size: 18px;
  }

  /* Reset layout positioning for mobile */
  .header-layout-top-center .header-wrapper,
  .header-layout-middle-center .header-wrapper {
    flex-direction: row;
  }

  .header-layout-top-center .header__logo,
  .header-layout-middle-center .header__logo {
    position: static;
    transform: none;
    margin: 0;
  }

  .header-layout-top-center .header__right,
  .header-layout-middle-center .header__right {
    position: static;
  }

  /* Bigger icons on mobile */
  .header__icons {
    gap: 12px;
  }

  .header__icon svg {
    width: 20px;
    height: 20px;
  }

  .header__icon {
    padding: 6px;
  }

  /* Fix cart count badge - smaller than icon */
  .cart-count {
    font-size: 9px;
    padding: 1px 4px;
    min-width: 16px;
    top: 0;
    right: -2px;
  }
}

@media screen and (min-width: 769px) {
  .header__menu {
    display: block !important;
  }
}
{% endstylesheet %}

<script>
// Sticky Header Scroll Effect
document.addEventListener('DOMContentLoaded', function() {
  const header = document.querySelector('.site-header');
  const announcementBar = document.querySelector('.announcement-bar');

  if (header && header.classList.contains('header-sticky')) {
    const setHeaderHeight = () => {
      const announcementBarHeight = announcementBar ? announcementBar.offsetHeight : 0;
      const headerHeight = header.offsetHeight;

      document.documentElement.style.setProperty('--header-height', headerHeight + 'px');
      document.documentElement.style.setProperty('--announcement-bar-height', announcementBarHeight + 'px');

      if (announcementBar) {
        header.style.top = announcementBarHeight + 'px';
      }

      /* No body padding — header overlays content (transparent) */
    };

    setHeaderHeight();
    window.addEventListener('resize', setHeaderHeight, { passive: true });

    let lastScrollTop = 0;
    let ticking = false;

    window.addEventListener('scroll', function() {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      if (!ticking) {
        window.requestAnimationFrame(function() {
          if (scrollTop > 50) {
            header.classList.add('scrolled');
          } else {
            header.classList.remove('scrolled');
          }

          lastScrollTop = scrollTop;
          ticking = false;
        });

        ticking = true;
      }
    }, { passive: true });
  }

  // Mobile Menu Toggle
  const menuBtn = document.querySelector('.header__mobile-menu-btn');
  const menuDrawer = document.querySelector('.mobile-menu-drawer');
  const menuClose = document.querySelector('.mobile-menu-close');
  const menuOverlay = document.querySelector('.mobile-menu-overlay');

  if (menuBtn && menuDrawer && menuOverlay) {
    menuBtn.addEventListener('click', function(e) {
      e.preventDefault();
      menuDrawer.classList.add('active');
      menuOverlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    });
  }

  function closeMobileMenu() {
    if (menuDrawer) menuDrawer.classList.remove('active');
    if (menuOverlay) menuOverlay.classList.remove('active');
    document.body.style.overflow = '';
  }

  if (menuClose) {
    menuClose.addEventListener('click', function(e) {
      e.preventDefault();
      closeMobileMenu();
    });
  }

  if (menuOverlay) {
    menuOverlay.addEventListener('click', closeMobileMenu);
  }

  // Mobile Submenu Toggle
  const submenuToggles = document.querySelectorAll('.mobile-submenu-toggle');
  submenuToggles.forEach(toggle => {
    toggle.addEventListener('click', function(e) {
      e.preventDefault();
      const submenu = this.nextElementSibling;
      if (submenu) {
        submenu.classList.toggle('active');
        this.classList.toggle('active');
      }
    });
  });

  // Predictive Search (reuse from theme.liquid)
  const input = document.getElementById('HeaderSearchInput');
  const results = document.getElementById('PredictiveResults');
  const recentBox = document.getElementById('RecentSearches');

  if (input && results) {
    let controller;

    function highlight(text, query) {
      const reg = new RegExp(`(${query})`, 'gi');
      return text.replace(reg, '<span class="highlight">$1</span>');
    }

    function saveRecent(query) {
      let searches = JSON.parse(localStorage.getItem('recent_searches') || '[]');
      searches = searches.filter(s => s !== query);
      searches.unshift(query);
      localStorage.setItem('recent_searches', JSON.stringify(searches.slice(0, 5)));
    }

    function showRecent() {
      const searches = JSON.parse(localStorage.getItem('recent_searches') || '[]');
      if (!searches.length) return;

      recentBox.innerHTML = searches.map(s => `<div>${s}</div>`).join('');
      recentBox.style.display = 'block';
    }

    input.addEventListener('focus', showRecent);

    if (recentBox) {
      recentBox.addEventListener('click', e => {
        input.value = e.target.innerText;
        input.dispatchEvent(new Event('input'));
        recentBox.style.display = 'none';
      });
    }

    input.addEventListener('input', async () => {
      const query = input.value.trim();
      if (recentBox) recentBox.style.display = 'none';

      if (query.length < 2) {
        results.style.display = 'none';
        return;
      }

      results.innerHTML = '<div class="no-results">Searching...</div>';
      results.style.display = 'block';

      if (controller) controller.abort();
      controller = new AbortController();

      try {
        const res = await fetch(`/search/suggest.json?q=${query}&resources[type]=product&resources[limit]=6`);
        const data = await res.json();
        const products = data.resources.results.products;

        saveRecent(query);

        if (!products.length) {
          results.innerHTML = `<div class="no-results">No results found for "${query}"</div>`;
          return;
        }

        results.innerHTML = products.map(p => `
          <a href="${p.url}" class="search-item">
            <img src="${p.featured_image.url}" alt="${p.title}">
            <div>
              <div class="search-title">${highlight(p.title, query)}</div>
              <div class="search-price">₹${(p.price / 100).toFixed(2)}</div>
            </div>
          </a>
        `).join('') + `<a class="view-all" href="/search?q=${query}&type=product">View all results →</a>`;
      } catch (error) {
        console.error('Search error:', error);
      }
    });

    document.addEventListener('click', e => {
      if (!e.target.closest('.header__search')) {
        results.style.display = 'none';
        if (recentBox) recentBox.style.display = 'none';
      }
    });
  }

  // Mobile Header Search (predictive)
  const mobileHeaderInput = document.getElementById('MobileHeaderSearchInput');
  const mobileHeaderResults = document.getElementById('MobileHeaderPredictiveResults');

  if (mobileHeaderInput && mobileHeaderResults) {
    let mobileHeaderController;

    function mobileHighlight(text, query) {
      const reg = new RegExp(`(${query})`, 'gi');
      return text.replace(reg, '<span class="highlight">$1</span>');
    }

    mobileHeaderInput.addEventListener('input', async () => {
      const query = mobileHeaderInput.value.trim();

      if (query.length < 2) {
        mobileHeaderResults.style.display = 'none';
        return;
      }

      mobileHeaderResults.innerHTML = '<div class="no-results">Searching...</div>';
      mobileHeaderResults.style.display = 'block';

      if (mobileHeaderController) mobileHeaderController.abort();
      mobileHeaderController = new AbortController();

      try {
        const res = await fetch(`/search/suggest.json?q=${query}&resources[type]=product&resources[limit]=5`);
        const data = await res.json();
        const products = data.resources.results.products;

        if (!products.length) {
          mobileHeaderResults.innerHTML = `<div class="no-results">No results for "${query}"</div>`;
          return;
        }

        mobileHeaderResults.innerHTML = products.map(p => `
          <a href="${p.url}" class="search-item">
            <img src="${p.featured_image.url}" alt="${p.title}">
            <div>
              <div class="search-title">${mobileHighlight(p.title, query)}</div>
              <div class="search-price">₹${(p.price / 100).toFixed(2)}</div>
            </div>
          </a>
        `).join('') + `<a class="view-all" href="/search?q=${query}&type=product">View all →</a>`;
      } catch (error) {
        console.error('Mobile header search error:', error);
      }
    });

    document.addEventListener('click', e => {
      if (!e.target.closest('.header__mobile-search')) {
        mobileHeaderResults.style.display = 'none';
      }
    });
  }

  // Cart Count Update - Listen for cart:updated event
  function updateCartCount() {
    fetch('/cart.js')
      .then(response => response.json())
      .then(cart => {
        const cartIcons = document.querySelectorAll('.header__cart-icon');
        cartIcons.forEach(icon => {
          let countBadge = icon.querySelector('.cart-count');

          if (cart.item_count > 0) {
            if (!countBadge) {
              countBadge = document.createElement('span');
              countBadge.className = 'cart-count';
              icon.appendChild(countBadge);
            }
            countBadge.textContent = cart.item_count;
          } else if (countBadge) {
            countBadge.remove();
          }
        });
      })
      .catch(error => console.error('Error updating cart count:', error));
  }

  // Listen for cart:updated event from product pages
  document.addEventListener('cart:updated', updateCartCount);
});
</script>

{% schema %}
{
  "name": "Header",
  "tag": "section",
  "class": "section-header",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "logo_position",
      "label": "Logo position",
      "options": [
        {
          "value": "top-left",
          "label": "Top left"
        },
        {
          "value": "top-center",
          "label": "Top center"
        },
        {
          "value": "top-right",
          "label": "Top right"
        },
        {
          "value": "middle-left",
          "label": "Middle left"
        },
        {
          "value": "middle-center",
          "label": "Middle center (logo centered, menu on sides)"
        },
        {
          "value": "middle-right",
          "label": "Middle right"
        }
      ],
      "default": "middle-left",
      "info": "Choose how your logo is positioned in the header"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 80,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "Desktop logo width",
      "default": 150,
      "info": "Best logo: PNG or SVG, 300x90px at 2x (600x180px), transparent background"
    },
    {
      "type": "header",
      "content": "Desktop Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu",
      "info": "Select which menu to display in the header"
    },
    {
      "type": "select",
      "id": "menu_type_desktop",
      "label": "Desktop menu type",
      "options": [
        {
          "value": "standard",
          "label": "Standard dropdown"
        },
        {
          "value": "mega",
          "label": "Mega menu"
        },
        {
          "value": "drawer",
          "label": "Drawer (opens from side)"
        }
      ],
      "default": "standard",
      "info": "Choose how your desktop menu displays"
    },
    {
      "type": "header",
      "content": "Mobile Navigation"
    },
    {
      "type": "link_list",
      "id": "mobile_menu",
      "label": "Mobile menu",
      "default": "main-menu",
      "info": "Select menu for mobile devices (can be different from desktop)"
    },
    {
      "type": "select",
      "id": "mobile_menu_logo_position",
      "label": "Mobile menu logo position",
      "options": [
        { "value": "top-left", "label": "Top left" },
        { "value": "top-center", "label": "Top center" },
        { "value": "top-right", "label": "Top right" },
        { "value": "bottom-left", "label": "Bottom left" },
        { "value": "bottom-center", "label": "Bottom center" },
        { "value": "bottom-right", "label": "Bottom right" }
      ],
      "default": "top-left",
      "info": "Position of the logo inside the mobile navigation drawer"
    },
    {
      "type": "range",
      "id": "mobile_menu_logo_width",
      "min": 60,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Mobile logo width",
      "default": 120,
      "info": "Best logo: PNG or SVG, 240x70px at 2x (480x140px), transparent background"
    },
    {
      "type": "header",
      "content": "Header Features"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_header",
      "label": "Enable sticky header",
      "default": true,
      "info": "Header stays at top when scrolling"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show search",
      "default": true
    },
    {
      "type": "header",
      "content": "Color Scheme"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "margin_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Margin top",
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Margin bottom",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "mega_menu_promo",
      "name": "Mega menu promo",
      "settings": [
        {
          "type": "number",
          "id": "menu_index",
          "label": "Menu item index (0-based)",
          "default": 0,
          "info": "Which top-level menu item this promo belongs to. 0 = first item, 1 = second, etc."
        },
        {
          "type": "image_picker",
          "id": "promo_image",
          "label": "Promo image"
        },
        {
          "type": "text",
          "id": "promo_label",
          "label": "Label",
          "default": "New arrival"
        },
        {
          "type": "text",
          "id": "promo_heading",
          "label": "Heading",
          "default": "Spring collection"
        },
        {
          "type": "text",
          "id": "promo_cta",
          "label": "Call to action text",
          "default": "Shop now"
        },
        {
          "type": "url",
          "id": "promo_url",
          "label": "Link"
        }
      ]
    }
  ],
  "max_blocks": 8
}
{% endschema %}
